#!/bin/bash
# ============================================================
# TAK SERVER LXD DEPLOYMENT - USER CONFIGURATION
# ============================================================
#
# PURPOSE:
# This file contains ALL user-specific configuration values
# needed for a complete TAK Server deployment. Fill this out
# COMPLETELY before starting the installation process.
#
# HOW TO USE:
# 1. Copy this file: cp env.template my-deployment.env
# 2. Fill in ALL required values below
# 3. Save the file securely (contains passwords!)
# 4. Reference values during manual installation
# 5. Future: Can be sourced by automation scripts
#
# PLACEHOLDER SYNTAX:
# When copying values to commands, replace brackets AND text.
# Example: If YOUR_VPS_IP="203.0.113.50"
#   Command shows: ssh takadmin@[YOUR_VPS_IP]
#   You type:      ssh takadmin@203.0.113.50
#
# ============================================================


# ============================================================
# SECTION 1: VPS & NETWORK CONFIGURATION
# Used in: Phase 1 (LXD Setup), Phase 5 (Networking)
# ============================================================

# Your VPS public IP address (from provider dashboard)
YOUR_VPS_IP=""

# Short hostname for your VPS (lowercase, no spaces)
# Examples: takvps, takprod, mytak
YOUR_VPS_HOSTNAME=""

# Your TAK server fully qualified domain name
# Must have DNS A record pointing to YOUR_VPS_IP
# Example: tak.example.com
YOUR_DOMAIN=""

# Your base domain (for DNS references)
# Example: example.com
YOUR_BASE_DOMAIN=""

# Timezone for your server
# Find yours: timedatectl list-timezones | grep America
# Example: America/Denver, America/New_York, Europe/London
YOUR_TIMEZONE=""


# ============================================================
# SECTION 2: CONTAINER NETWORK (Option B - Static IPs)
# Used in: Phase 1, Phase 2, Phase 5, Supplemental Guides
# ============================================================
#
# This deployment uses a dedicated LXD bridge network (takbr0)
# with predictable static IPs for all containers.
#
# Network: 10.100.100.0/24
# Gateway: 10.100.100.1 (the bridge itself)
# Static:  10.100.100.10-99 (containers)
# DHCP:    10.100.100.100-199 (auto-assigned if needed)
#
# These defaults work for most deployments.
# Only change if you have specific network requirements.
# ------------------------------------------------------------

# LXD Bridge name
LXD_BRIDGE_NAME="takbr0"

# Bridge subnet and gateway IP (host side of bridge)
LXD_BRIDGE_SUBNET="10.100.100.0/24"
LXD_BRIDGE_IP="10.100.100.1"

# Container static IPs (core services)
TAK_CONTAINER_IP="10.100.100.10"
HAPROXY_CONTAINER_IP="10.100.100.11"

# Optional service container IPs (uncomment if using)
# MEDIAMTX_CONTAINER_IP="10.100.100.12"
# NEXTCLOUD_CONTAINER_IP="10.100.100.13"
# NODERED_CONTAINER_IP="10.100.100.14"


# ============================================================
# SECTION 3: ORGANIZATION INFORMATION
# Used in: Phase 3 (TAK Installation - Certificate Generation)
# ============================================================
#
# These values appear in your SSL certificates.
# Use your actual organization info for production.
# ------------------------------------------------------------

# Your organization's full name
# Example: Mountain Search and Rescue, Boise Fire Protection District
YOUR_ORG=""

# Root Certificate Authority name (short, no spaces)
# Prompt: "Enter a name for the Root CA:"
# Example: MSAR, BFPD, YOURORG
YOUR_CA_NAME=""

# Intermediate Certificate Authority name (short, no spaces)
# Prompt: "Enter a name for the Intermediate CA:"
# Example: MSAR-INT, BFPD-INT, YOURORG-INT
YOUR_INT_CA_NAME=""

# State or Province (full name)
# Example: Colorado, California, Idaho
YOUR_STATE=""

# City
# Example: Denver, Los Angeles, Boise
YOUR_CITY=""

# Organizational Unit (optional, can leave empty or use "NA")
# Example: Communications, IT, Operations
YOUR_UNIT=""

# TAK Server description for Data Packages
# Prompt: "Enter a short description of this TAK Server connection"
# This is displayed on TAK clients when connecting
# Example: Mountain SAR TAK, Boise FD TAK, My Team TAK
TAK_SERVER_NAME=""


# ============================================================
# SECTION 4: CREDENTIALS & PASSWORDS
# Used in: Phase 3, Phase 4, Phase 5, Supplemental Guides
# ============================================================
#
# WARNING: Set strong passwords - no defaults!
# WARNING: Store this file securely - it contains secrets!
# ------------------------------------------------------------

# Certificate password (for ALL .p12 and .jks files)
# Minimum 8 characters, recommend using special characters
# DO NOT use default 'atakatak' - it is widely known!
CERT_PASSWORD=""

# HAProxy statistics page credentials
# Access via SSH tunnel: http://localhost:8404/haproxy_stats
HAPROXY_STATS_USER="admin"
HAPROXY_STATS_PASSWORD=""

# Email for Let's Encrypt notifications
# Receives certificate expiry warnings (90-day certs)
YOUR_EMAIL=""

# Node-RED credential secret (if using Node-RED)
# Encrypts stored credentials in flows
# Generate with: openssl rand -hex 24
NODERED_CREDENTIAL_SECRET=""


# ============================================================
# SECTION 5: TAK SERVER FILES
# Used in: Phase 2, Phase 3
# ============================================================
#
# !!! READ CAREFULLY - Common source of errors !!!
#
# The TAK Server filename uses BOTH hyphens AND underscores:
#   takserver-5.5-RELEASE##_all.deb
#             ^         ^
#          hyphen    underscore
#
# CORRECT: takserver-5.5-RELEASE58_all.deb
# WRONG:   takserver_5.5_RELEASE58_all.deb (all underscores)
# WRONG:   takserver-5.5-RELEASE58-all.deb (all hyphens)
#
# Download from: https://tak.gov/products/tak-server
# ------------------------------------------------------------

# TAK Server .deb filename (EXACT as downloaded)
TAK_DEB_FILENAME=""

# Container names (defaults work for most deployments)
TAK_CONTAINER_NAME="tak"
HAPROXY_CONTAINER_NAME="haproxy"


# ============================================================
# SECTION 6: OPTIONAL SERVICES
# Used in: Supplemental Guides (S1-MediaMTX, S2-Node-RED)
# ============================================================

# Let's Encrypt SSL certificates (recommended for production)
ENABLE_LETSENCRYPT="yes"

# MediaMTX - RTSP video streaming (TAK ICU, drones, IP cameras)
# See: S1-MEDIAMTX-SETUP.md
ENABLE_MEDIAMTX="no"

# NextCloud - File sharing and collaboration
ENABLE_NEXTCLOUD="no"

# Node-RED - Automation and data integration
# See: S2-NODERED-SETUP.md
ENABLE_NODERED="no"


# ============================================================
# SECTION 7: DNS RECORDS CHECKLIST
# ============================================================
#
# Create these DNS A records BEFORE starting Phase 5.
# All records point to: YOUR_VPS_IP
#
# Required:
#   tak.[YOUR_BASE_DOMAIN]    -> [YOUR_VPS_IP]
#
# Optional (create if using these services):
#   files.[YOUR_BASE_DOMAIN]  -> [YOUR_VPS_IP]  (NextCloud)
#   rtsp.[YOUR_BASE_DOMAIN]   -> [YOUR_VPS_IP]  (MediaMTX)
#   nodered.[YOUR_BASE_DOMAIN] -> [YOUR_VPS_IP] (Node-RED, if exposed)
#
# Verify DNS propagation:
#   dig tak.[YOUR_BASE_DOMAIN] +short
#   nslookup tak.[YOUR_BASE_DOMAIN]
# ============================================================


# ============================================================
# SECTION 8: PORT REFERENCE
# ============================================================
#
# Required ports (open in VPS firewall):
#   22   - SSH (remote administration)
#   80   - HTTP (ACME/Let's Encrypt challenges)
#   8089 - TAK client connections (streaming)
#   8443 - TAK Web UI (administration)
#   8446 - TAK certificate enrollment
#
# Optional ports (open only if using these services):
#   443  - HTTPS (NextCloud, other web services)
#   1880 - Node-RED editor (recommend SSH tunnel instead)
#   8554 - RTSP video streaming (MediaMTX)
#   8404 - HAProxy stats (SSH tunnel only - never expose!)
#
# ============================================================


# ============================================================
# SECTION 9: COMPUTED VALUES (DO NOT EDIT)
# These are derived from values above for use in scripts
# ============================================================

# Full CA names as they appear in certificates
FULL_ROOT_CA_NAME="${YOUR_CA_NAME}"
FULL_INT_CA_NAME="${YOUR_INT_CA_NAME}"

# Let's Encrypt keystore filename
LE_KEYSTORE_FILENAME="${YOUR_VPS_HOSTNAME}-le.jks"

# TAK repository files
TAK_GPG_KEY_FILENAME="takserver-public-gpg.key"
TAK_POLICY_FILENAME="deb_policy.pol"


# ============================================================
# QUICK REFERENCE - VALUES BY PHASE
# ============================================================
#
# PHASE 1: LXD Setup
#   YOUR_VPS_IP, YOUR_VPS_HOSTNAME, YOUR_TIMEZONE
#   LXD_BRIDGE_NAME, LXD_BRIDGE_SUBNET, LXD_BRIDGE_IP
#
# PHASE 2: Container Setup
#   TAK_CONTAINER_NAME, TAK_CONTAINER_IP
#   YOUR_TIMEZONE, TAK_DEB_FILENAME
#
# PHASE 3: TAK Installation
#   YOUR_DOMAIN, YOUR_ORG, YOUR_CA_NAME, YOUR_INT_CA_NAME
#   YOUR_STATE, YOUR_CITY, YOUR_UNIT
#   CERT_PASSWORD, TAK_DEB_FILENAME, TAK_SERVER_NAME
#
# PHASE 4: Certificate Management
#   YOUR_CA_NAME, YOUR_INT_CA_NAME, CERT_PASSWORD
#
# PHASE 5: Networking (HAProxy & Let's Encrypt)
#   YOUR_DOMAIN, YOUR_VPS_IP, YOUR_EMAIL
#   TAK_CONTAINER_IP, HAPROXY_CONTAINER_IP
#   HAPROXY_STATS_USER, HAPROXY_STATS_PASSWORD
#   CERT_PASSWORD (for JKS conversion)
#
# PHASE 6: Verification
#   YOUR_DOMAIN, CERT_PASSWORD
#
# SUPPLEMENTAL - MediaMTX (S1):
#   MEDIAMTX_CONTAINER_IP, YOUR_DOMAIN
#
# SUPPLEMENTAL - Node-RED (S2):
#   NODERED_CONTAINER_IP, NODERED_CREDENTIAL_SECRET
#   CERT_PASSWORD (for TAK certificate decryption)
#
# ============================================================


# ============================================================
# END OF CONFIGURATION
# ============================================================
#
# NEXT STEPS:
# 1. Verify all required fields are filled in
# 2. Save this file securely (it contains passwords!)
# 3. Create DNS records (Section 7)
# 4. Begin with Phase 1: LXD Setup
#
# Documentation:
#   GitHub: https://github.com/mighkel/installTAK-LXD
#
# ============================================================

#!/bin/bash
# ============================================================
# TAK SERVER LXD DEPLOYMENT - USER CONFIGURATION
# ============================================================
#
# PURPOSE:
# This file contains ALL user-specific configuration values
# needed for a complete TAK Server deployment. Fill this out
# COMPLETELY before starting the installation process.
#
# HOW TO USE:
# 1. Copy this file: cp env.template my-deployment.env
# 2. Fill in ALL required values below
# 3. Save the file securely (contains passwords!)
# 4. Reference values during manual installation
# 5. Future: Can be sourced by automation scripts
#
# PLACEHOLDER SYNTAX:
# When copying values to commands, replace brackets AND text.
# Example: If YOUR_VPS_IP="203.0.113.50"
#   Command shows: ssh takadmin@[YOUR_VPS_IP]
#   You type:      ssh takadmin@203.0.113.50
#
# ============================================================


# ============================================================
# SECTION 1: VPS & NETWORK CONFIGURATION
# Used in: Phase 1 (LXD Setup), Phase 5 (Networking)
# ============================================================

# Your VPS public IP address (from provider dashboard)
YOUR_VPS_IP=""

# Short hostname for your VPS (lowercase, no spaces)
# Examples: takvps, takprod, mytak
YOUR_VPS_HOSTNAME=""

# Your TAK server fully qualified domain name
# Must have DNS A record pointing to YOUR_VPS_IP
# Example: tak.example.com
YOUR_DOMAIN=""

# Your base domain (for DNS references)
# Example: example.com
YOUR_BASE_DOMAIN=""

# Timezone for your server
# Find yours: timedatectl list-timezones | grep America
# Example: America/Denver, America/New_York, Europe/London
YOUR_TIMEZONE=""


# ============================================================
# SECTION 2: CONTAINER NETWORK (Option B - Static IPs)
# Used in: Phase 1, Phase 2, Phase 5
# ============================================================
#
# This deployment uses a dedicated LXD bridge network (takbr0)
# with predictable static IPs for all containers.
#
# Network: 10.100.100.0/24
# Gateway: 10.100.100.1 (the bridge itself)
# Static:  10.100.100.10-99 (containers)
# DHCP:    10.100.100.100-199 (auto-assigned if needed)
#
# These defaults work for most deployments.
# Only change if you have specific network requirements.
# ------------------------------------------------------------

# LXD Bridge name
LXD_BRIDGE_NAME="takbr0"

# Bridge gateway IP (host side of bridge)
LXD_BRIDGE_SUBNET="10.100.100.0/24"
LXD_BRIDGE_IP="10.100.100.1"

# Container static IPs
TAK_CONTAINER_IP="10.100.100.10"
HAPROXY_CONTAINER_IP="10.100.100.11"

# Optional service container IPs (uncomment if using)
# MEDIAMTX_CONTAINER_IP="10.100.100.12"
# NEXTCLOUD_CONTAINER_IP="10.100.100.13"


# ============================================================
# SECTION 3: ORGANIZATION INFORMATION
# Used in: Phase 3 (TAK Installation - Certificate Generation)
# ============================================================
#
# These values appear in your SSL certificates.
# Use your actual organization info for production.
# ------------------------------------------------------------

# Your organization's full name
# Example: Mountain Search and Rescue
YOUR_ORG=""

# Certificate Authority name prefix (short, no spaces)
# Becomes part of root CA name: [YOUR_CA_NAME]-ROOT-CA
# Example: MSAR, YOURORG
YOUR_CA_NAME=""

# Intermediate Certificate Authority name prefix (short, no spaces)
# Becomes part of Intermediate CA name: [YOUR_INT_CA_NAME]-INTERMEDIATE-CA
# Example: MSARINT, YOURORGINT
YOUR_INT_CA_NAME=""

# State or Province (full name)
# Example: Colorado, California
YOUR_STATE=""

# City
# Example: Denver, Los Angeles
YOUR_CITY=""

# Organizational Unit (optional, use "NA" if none)
# Example: Communications, IT, Operations
YOUR_UNIT=""

# TAK Server Name in Data Package for EUDs
# Example: Mtn SAR TAK Server
TAK_SERVER_NAME=""

# ============================================================
# SECTION 4: CREDENTIALS & PASSWORDS
# Used in: Phase 3, Phase 4, Phase 5
# ============================================================
#
# ⚠️  IMPORTANT: Set strong passwords - no defaults!
# ⚠️  Store this file securely - it contains secrets!
# ------------------------------------------------------------

# Certificate password (for ALL .p12 and .jks files)
# Minimum 8 characters, use special characters
# ⛔ DO NOT use default 'atakatak' - widely known!
CERT_PASSWORD=""

# HAProxy statistics page password
# Access via SSH tunnel: http://localhost:8404/haproxy_stats
HAPROXY_STATS_USER="admin"
HAPROXY_STATS_PASSWORD=""

# Email for Let's Encrypt notifications
# Receives certificate expiry warnings (90-day certs)
YOUR_EMAIL=""


# ============================================================
# SECTION 5: TAK SERVER FILES
# Used in: Phase 2, Phase 3
# ============================================================
#
# ⛔ READ CAREFULLY - Common source of errors!
#
# The TAK Server filename uses BOTH hyphens AND underscores:
#   takserver-5.5-RELEASE##_all.deb
#             ^         ^
#          hyphen    underscore
#
# CORRECT: takserver-5.5-RELEASE58_all.deb
# WRONG:   takserver_5.5_RELEASE58_all.deb (all underscores)
# WRONG:   takserver-5.5-RELEASE58-all.deb (all hyphens)
#
# Download from: https://tak.gov/products/tak-server
# ------------------------------------------------------------

# TAK Server .deb filename (EXACT as downloaded)
TAK_DEB_FILENAME=""

# Container names
TAK_CONTAINER_NAME="tak"
HAPROXY_CONTAINER_NAME="haproxy"


# ============================================================
# SECTION 6: OPTIONAL SERVICES
# Used in: Phase 5 (Networking)
# ============================================================

# Let's Encrypt SSL certificates (recommended)
ENABLE_LETSENCRYPT="yes"

# MediaMTX - RTSP video streaming
# For drone feeds, surveillance cameras, etc.
ENABLE_MEDIAMTX="no"

# NextCloud - File sharing
ENABLE_NEXTCLOUD="no"


# ============================================================
# SECTION 7: DNS RECORDS CHECKLIST
# ============================================================
#
# Create these DNS A records BEFORE starting Phase 5.
# All records point to: YOUR_VPS_IP
#
# Required:
#   tak.[YOUR_BASE_DOMAIN] → [YOUR_VPS_IP]
#
# Optional (if using):
#   files.[YOUR_BASE_DOMAIN] → [YOUR_VPS_IP]  (NextCloud)
#   rtsp.[YOUR_BASE_DOMAIN] → [YOUR_VPS_IP]   (MediaMTX)
#
# Verify: dig tak.[YOUR_BASE_DOMAIN] +short
# ============================================================


# ============================================================
# SECTION 8: PORT REFERENCE
# ============================================================
#
# Required ports (open in VPS firewall):
#   22   - SSH
#   80   - HTTP (ACME/Let's Encrypt)
#   8089 - TAK client connections
#   8443 - TAK Web UI
#   8446 - TAK certificate enrollment
#
# Optional:
#   443  - HTTPS (web services)
#   8554 - RTSP (MediaMTX)
#   8404 - HAProxy stats (SSH tunnel only)
# ============================================================


# ============================================================
# SECTION 9: COMPUTED VALUES (DO NOT EDIT)
# ============================================================

FULL_CA_NAME="${YOUR_CA_NAME}-ROOT-CA"
LE_KEYSTORE_FILENAME="${TAK_CONTAINER_NAME}-le.jks"
TAK_GPG_KEY_FILENAME="takserver-public-gpg.key"
TAK_POLICY_FILENAME="deb_policy.pol"


# ============================================================
# QUICK REFERENCE - VALUES BY PHASE
# ============================================================
#
# PHASE 1: LXD Setup
#   YOUR_VPS_IP, YOUR_VPS_HOSTNAME
#   LXD_BRIDGE_NAME, LXD_BRIDGE_SUBNET, LXD_BRIDGE_IP
#
# PHASE 2: Container Setup
#   TAK_CONTAINER_NAME, TAK_CONTAINER_IP
#   YOUR_TIMEZONE, TAK_DEB_FILENAME
#
# PHASE 3: TAK Installation
#   YOUR_DOMAIN, YOUR_ORG, YOUR_CA_NAME
#   YOUR_STATE, YOUR_CITY, YOUR_UNIT
#   CERT_PASSWORD, TAK_DEB_FILENAME
#
# PHASE 4: Certificate Management
#   YOUR_CA_NAME, CERT_PASSWORD
#
# PHASE 5: Networking
#   YOUR_DOMAIN, YOUR_VPS_IP, YOUR_EMAIL
#   TAK_CONTAINER_IP, HAPROXY_CONTAINER_IP
#   HAPROXY_STATS_USER, HAPROXY_STATS_PASSWORD
#   CERT_PASSWORD (for JKS conversion)
#
# PHASE 6: Verification
#   YOUR_DOMAIN, CERT_PASSWORD
#
# ============================================================


# ============================================================
# END OF CONFIGURATION
# ============================================================
#
# NEXT STEPS:
# 1. Verify all required fields are filled in
# 2. Save this file securely
# 3. Create DNS records (Section 7)
# 4. Begin with Phase 1: LXD Setup
#
# Resources:
#   GitHub: https://github.com/mighkel/installTAK-LXD
#   TAK Syndicate: https://www.thetaksyndicate.org/
#
# ============================================================


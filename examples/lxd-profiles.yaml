# ============================================================
# LXD Profile for TAK Server Deployment
# ============================================================
#
# This profile configures containers for the installTAK-LXD deployment
# using Option B networking: dedicated takbr0 bridge (10.100.100.0/24)
#
# USAGE:
#   1. Create the takbr0 network first (see Phase 1 documentation)
#   2. Create this profile: lxc profile create tak-profile
#   3. Edit the profile: lxc profile edit tak-profile < lxd-profiles.yaml
#   4. Apply to containers: lxc profile add tak tak-profile
#
# NOTE: This profile provides defaults. Container-specific settings
#       (like static IPs) are applied when launching containers.
#
# ============================================================

config:
  # Security settings for containers
  security.nesting: "false"
  security.privileged: "false"
  
  # Boot settings
  boot.autostart: "true"
  boot.autostart.delay: "10"
  boot.autostart.priority: "5"

description: TAK Server deployment profile for installTAK-LXD

devices:
  # Root filesystem with reasonable limits
  root:
    path: /
    pool: default
    size: 50GB
    type: disk

  # Network connection to takbr0
  eth0:
    name: eth0
    network: takbr0
    type: nic

name: tak-profile

# ============================================================
# CONTAINER CREATION WITH STATIC IPs
# ============================================================
#
# When launching containers, assign static IPs using this pattern:
#
#   1. Launch with network flag
#   2. Wait for startup
#   3. Stop container
#   4. Set static IP
#   5. Start container
#
# This stop/start cycle is required because the network device
# is created at launch time, and IP changes require restart.
#
# ------------------------------------------------------------
# TAK Server Container (10.100.100.10):
# ------------------------------------------------------------
#   lxc launch ubuntu:22.04 tak --network takbr0
#   sleep 5
#   lxc stop tak
#   lxc config device set tak eth0 ipv4.address=10.100.100.10
#   lxc start tak
#
# ------------------------------------------------------------
# HAProxy Container (10.100.100.11):
# ------------------------------------------------------------
#   lxc launch ubuntu:22.04 haproxy --network takbr0
#   sleep 5
#   lxc stop haproxy
#   lxc config device set haproxy eth0 ipv4.address=10.100.100.11
#   lxc start haproxy
#
# ------------------------------------------------------------
# MediaMTX Container (10.100.100.12) - Optional:
# ------------------------------------------------------------
#   lxc launch ubuntu:22.04 mediamtx --network takbr0
#   sleep 5
#   lxc stop mediamtx
#   lxc config device set mediamtx eth0 ipv4.address=10.100.100.12
#   lxc start mediamtx
#
# ------------------------------------------------------------
# NextCloud Container (10.100.100.13) - Optional:
# ------------------------------------------------------------
#   lxc launch ubuntu:22.04 nextcloud --network takbr0
#   sleep 5
#   lxc stop nextcloud
#   lxc config device set nextcloud eth0 ipv4.address=10.100.100.13
#   lxc start nextcloud
#
# ------------------------------------------------------------
# Node-RED Container (10.100.100.14) - Optional:
# ------------------------------------------------------------
#   lxc launch ubuntu:22.04 nodered --network takbr0
#   sleep 5
#   lxc stop nodered
#   lxc config device set nodered eth0 ipv4.address=10.100.100.14
#   lxc start nodered
#
# ============================================================


# ============================================================
# NETWORK CREATION COMMANDS (for reference)
# ============================================================
#
# Create the dedicated TAK bridge network:
#
#   lxc network create takbr0 \
#     ipv4.address=10.100.100.1/24 \
#     ipv4.nat=true \
#     ipv4.dhcp=true \
#     ipv4.dhcp.ranges=10.100.100.100-10.100.100.199 \
#     ipv6.address=none
#
# Verify the network:
#   lxc network show takbr0
#   lxc network list
#
# ============================================================


# ============================================================
# CONTAINER IP ASSIGNMENTS SUMMARY
# ============================================================
#
# Container     IP Address        Purpose
# ---------     ----------        -------
# tak           10.100.100.10     TAK Server
# haproxy       10.100.100.11     Reverse Proxy / Load Balancer
# mediamtx      10.100.100.12     RTSP Video Streaming (optional)
# nextcloud     10.100.100.13     File Sharing (optional)
# nodered       10.100.100.14     Automation & Integration (optional)
#
# Reserved:     10.100.100.15-99  Future static assignments
# DHCP Pool:    10.100.100.100-199  Auto-assigned (test containers, etc.)
#
# ============================================================
